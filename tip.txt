
Stockcode = input("please enter stock:")
Stockcode = int(Stockcode)
squre = Stockcode*Stockcode

name = input('please enter your name:')

// dynamic change string name
s1=72
s2=85
print("Name:%s Rasie:%.1f%%"%("Xiaoming", (s2-s1)/s1))

classmate = ['Mike', 'Bob', 'Tracy'] // List

classmates = ('Michael', 'Bob', 'Tracy') //tuple, initalzied at initalize

if ()
   下面的语句可以一直执行。4个空格相当于空格
   
 names = ['Michael', 'Bob', 'Tracy']
for name in names:
    print(name)
  
 days=[2001,2002,2003]
for name in names:
    for day in days:
        print(name,day)
    print(name, day,'end')


print("program exit")

Mike 2001
Mike 2002
Mike 2003
Mike 2003 end
Bob 2001
Bob 2002
Bob 2003
Bob 2003 end
Tracy 2001
Tracy 2002
Tracy 2003
Tracy 2003 end

where to look up function reference
https://docs.python.org/3/library/functions.html#abs 

def my_abs(x):
    if not isinstance(x, (int, float)):  -- this in in parameter type checking
        raise TypeError('bad operand type')
    if x >= 0:
        return x
    else:
        return -x
"from abstest import my_abs"
    --import function my_abs from file abstest.py

In python, 0.1*0.1= 0.010000000000000002, that's because the float accurate issue. we can round it if accurnt not needed.

slice, eg l[100] have 100 elements,  l[0:3] can take first 3,  l[-1:], is take last to head, 0 and -1,
l[::5] is pick up one each 5 elements
l[:] can duplicate whole list

tuple also can use slice

for (i=0; i<list.length; i++) {
    n = list[i];
}

[x * x for x in range(1, 11)]
[x * x for x in range(1, 11) if x % 2 == 0]

example of generator

>>> L = [x * x for x in range(10)]
>>> L
[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
>>> g = (x * x for x in range(10))
>>> g
<generator object <genexpr> at 0x1022ef630>  

import os
dir(os) 
upper two command can show os api supported

>>> f = open('dump.txt', 'wb')
>>> pickle.dump(d, f)
>>> f.close()

>>> f = open('dump.txt', 'rb')
>>> d = pickle.load(f)
>>> f.close()
>>> d
{'age': 20, 'score': 88, 'name': 'Bob'}

upper is save and reload Class Instant on Python

fork, father and child process.   getppid() from child process can get fathrer process id.

from multiprocessing import Process  -- this can create multi process on windows

Queue and Pipes can be used for process communication


threading (1st choice), _thread, are two libs for multi-thread
lock is used for multi-thread sync

python has GIL lock, every 100 code lines run, and free GIL lock. So, thread in one core.
GIL is per Process, so, we can use Process to replace Thread

It looks distrubute mulit machine not difficult in python, since python have many support libs.

re is zheng ze biao dai shi lib in phyton.

python has GUI lib

TK, wxWidgets  Qt, GTK  Tkinter is default, and built-in lib

Socket is TCP/IP lib

Email  smtplib and email libs.  email in charge for write email
smtplib is send

poplib is used for receive

Message
+- MIMEBase
   +- MIMEMultipart
   +- MIMENonMultipart
      +- MIMEMessage
      +- MIMEText
      +- MIMEImage



	

Stockcode = input("please enter stock:")
Stockcode = int(Stockcode)
squre = Stockcode*Stockcode

name = input('please enter your name:')

// dynamic change string name
s1=72
s2=85
print("Name:%s Rasie:%.1f%%"%("Xiaoming", (s2-s1)/s1))

classmate = ['Mike', 'Bob', 'Tracy'] // List

classmates = ('Michael', 'Bob', 'Tracy') //tuple, initalzied at initalize

if ()
   下面的语句可以一直执行。4个空格相当于空格
   
 names = ['Michael', 'Bob', 'Tracy']
for name in names:
    print(name)
  
 days=[2001,2002,2003]
for name in names:
    for day in days:
        print(name,day)
    print(name, day,'end')


print("program exit")

Mike 2001
Mike 2002
Mike 2003
Mike 2003 end
Bob 2001
Bob 2002
Bob 2003
Bob 2003 end
Tracy 2001
Tracy 2002
Tracy 2003
Tracy 2003 end

where to look up function reference
https://docs.python.org/3/library/functions.html#abs 

def my_abs(x):
    if not isinstance(x, (int, float)):  -- this in in parameter type checking
        raise TypeError('bad operand type')
    if x >= 0:
        return x
    else:
        return -x
"from abstest import my_abs"
    --import function my_abs from file abstest.py

In python, 0.1*0.1= 0.010000000000000002, that's because the float accurate issue. we can round it if accurnt not needed.

slice, eg l[100] have 100 elements,  l[0:3] can take first 3,  l[-1:], is take last to head, 0 and -1,
l[::5] is pick up one each 5 elements
l[:] can duplicate whole list

tuple also can use slice

for (i=0; i<list.length; i++) {
    n = list[i];
}

[x * x for x in range(1, 11)]
[x * x for x in range(1, 11) if x % 2 == 0]

example of generator

>>> L = [x * x for x in range(10)]
>>> L
[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
>>> g = (x * x for x in range(10))
>>> g
<generator object <genexpr> at 0x1022ef630>  

1/17

How to find installed libs in python?

: help ('modules')

It can show the moules loaded up.

How to get modules/object function and members?

: Dir()

How to rezie one JPG file?

from PIL import Image

im=Image.open()
im.thumbnail((w//2, h//2))
im.save('small.jpg','jpeg')

How to blur?
from PIL import Image, ImageFilter
im2 = im.filter(ImageFilter.BLUR)

How to make Phyton script can accept chinese character?

# -*- coding:utf-8 -*-

How to make web radom check string?

look radom_pic.py 

Does Python able to compile as binary?

py2exe is one tool to make exe distrbute
code sample as below:

# mysetup.py
from distutils.core import setup
import py2exe
setup(console=["helloworld.py"])
python mysetup.py py2exe
http://www.cnblogs.com/jans2002/archive/2006/09/30/519393.html

How to make .py run in linux as .sh file?

add #!/usr/bin/env python3

How to differ global variable?
Method 1, define global
[python] view plaincopyprint?
#global.py  
GLOBAL_1 = 1  
GLOBAL_2 = 2  
GLOBAL_3 = 'Hello World'

Method 2, use key words
CONSTANT = 0  
def modifyGlobal():  
    global CONSTANT  
    print(CONSTANT)  
    CONSTANT += 1  
if __name__ == '__main__':  
    modifyGlobal()  
    print(CONSTANT)

So, the main function use global variable,  def function is use local variable, if want to use global, need key words


Is there any strong Distrubute system based on python?
http://my.oschina.net/u/2306127/blog/417360

What's is JSON?

The eay to serial/save Obj in OOB language.
Ref URL: http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/00143192607210600a668b5112e4a979dd20e4661cc9c97000

How Tushare to read HTML?
Use pandas. read_html

http://pandas.pydata.org/pandas-docs/stable/api.html#html

How to get National data source?

http://data.stats.gov.cn/  

How to search World wide deposit rate?
www.deposits.org
add one feature to tushare, to get rate


How to translate Korean or Japen to chinese?
Baidu website translation

How to let source insight support Python?

Download Python.CLF  http://www.sourceinsight.com/public/languages/Python.CLF

www.cnblogs.com/xuxm2007/archive/2010/09/02/1815695.html

How to let source insighe show chinese correct?
Failed. Stop trying

How to check python import lib function guide?
help(module.function)
help(module)
dir()

How to copy from putty command window?
select in command line and press enter

Read tushare source code, 
1. know how one small function works.
2. can use console to debug line by line
3. need deep understand html struction, so that, know how. 
The next plan is trying to understand the html struct basic ideas.

#13; is html translation words, detial can refer to 
http://www.w3chtml.com/html/character.html
http://tool.oschina.net/commons?type=2

1. Ok, know how to get the table from html source..  Look the table as key words
<table?<thread><tr><td> will contain the table

html.xpath('//div[@class=\"fn_rp_list\"]/table') --> read all div with class name="fn_rp_list", get belower "table"
the return is element

also learn how the regular expression show up

(.*?) this is match as much as it can

Tushare profile_data read complete..
basiscly, it read 163 website, parse html find table, and juse pandas to make self table, then output

Check Deposit Rate and US exchange rate relationship.  In theory, should Rate down, exchange up, Rate up, exchange down

Deposite Rate: M 
2007.12 4.14% ~ 2010.10 2.5%
2010.10 2.5%~ 2011.7 3.5%
2011.7 3.5%~2015.8 1.75%

US exchange rate: if we look at from 2010, the theory is right. 

2007 7 2008 6.8  2010 6.6 2012 6.3 2014 6.1 2015 6.2  2016 6.5

check Korean as Example, draw depoist rate and exchange rate graphic

1-20
Read tushare file Reference.py xsg_data, more learn on how to parser from html data

How to modify tushare?

1. change source code
2. run python setup.py install. it will copy your change into some where under $PATH, then you can run new finished code

How to distubue one moudle like tushare?

1. single file, just copy to $python_dir/lib
2. multifile make setup.py, run python setup.py install
3. egg file.  download ez_setup.py, run python ez_setup, and easy_install *.egg

http://blog.csdn.net/ponder008/article/details/6592719/

How to setup Linux python development enviorment?

Eclipse, looks too big for me.
Try komodoide and Sublime (this is not good) 

How to run moudle or each function test?

Use test python script can do this. All the test cases is executed random sequence

How to debug python?

1. Print
2. log
3. pdb and IDE support debug

http://www.jetbrains.com/pycharm/  which is highlight by Python guide

china nuclear electrict power number?

How to dump class object in python?

print xxx.__dict__

How to understand urllib works? 

Need to understand http protocal, especially http header
Ref url:  http://www.cnblogs.com/yuzhongwusan/archive/2011/10/20/2218954.html

One interesting tool, read/get all employee name id photo.
1. web is https, so, need log in with http type   http://www.cnblogs.com/txw1958/archive/2011/12/21/2295698.html

What's the difference of ctrl+z and ctrl-c

ctrl+z just put to suspend, use fg/bg can put task in front or background run

ctrl+c break, can't restore

Task: get jisilu Exhange Bound data down

How to understand .js and html basic laungage?

When fetch web, should be reference netmoniter URL

Upgrade SM-N900 phone. To MIUI interface. One touch solution with xiamei, one software suggest by Xiaomi
SM-N900 TYG (Hongkong) 32 G SS Exynos 5420

it looks needs to buy unicom data card

Current is Andrios 4.4 ~.  Andrios 5.0 is aviable now.

1/25 


rishiqing -- one team project software
https://www.rishiqing.com/


2/11 
Form 13G  is stock larger 5% publish. QCOM has such announce at 2/11
S-1 IPO   F-1 Foregin IPO  10-K year report 10-Q season report, 8-K important event

update link-in
looking into spreadtrum..


Jisilu moudle has http bad 400 in C platform.

Thingking about WCDMA data plan or not

Thingking about HTTPs module

Jisilu problem solved. URL link is not correct

1/28 

Read AJAX,PHY,JavaScript,SQL,CSS, basic idea about web development. 

Now, start the beginning analysis of jisilu as learning 

Learn Baidu API for data analysis
http://tieba.baidu.com/p/2209206383

How to debug javascript?

http://han.guokai.blog.163.com/blog/static/136718271201321402514114/
also download one copy locally

JQuery..

Some understanding:
1.Javascript will be loaded when html doc is parsing
2.Some Javascript is execuet immediately
3.Javescirpt libary like JQuery may provide some framework to web developer to define

2/1

MS add 802.11ad phy native support
Looking for deck desktop , get basic idea
Get t-put la email, we should already do this.
Review LED spec, how to config is clear. who will detect state? ask fei check la side

p2p service/ipdoc/11ad , 1st day to review WDI spec. 
Finish scan/discover/connect

in usb selective suspend, as driver, it needs to request bus for usb idle

usb bus https://msdn.microsoft.com/en-us/library/windows/hardware/ff538089(v=vs.85).aspx
communication API

NDIS API
https://msdn.microsoft.com/en-us/library/windows/hardware/hh451431(v=vs.85).aspx

usb device works,excpet need maually start service

MSFT sample code to get locaction

https://code.msdn.microsoft.com/windowsapps/Geolocation-2483de66  

2/3

Read WiFI alliance
Update link-in
Consider planning

WFA 
2018 certification on Halow, 900M low power, low speed wifi 

http://www.wired.com/tag/halow/
http://www.wi-fi.org/news-events/media-coverage

IEEE802.11ah == Halow  vs LoRa vs BT

WFA Certification program:

1. n/ac/direct/wpa2/eap/11w/passpoint/wps/miracast/voe/vop/wifi-aware
2. tdls/wmm/wmm-admission/wmm_powersave
3. RF coexistence

Read hotspot2.0 spec

http://whatis.techtarget.com/definition/Access-Network-Query-Protocol-ANQP

Plan:

Chu2 zao
Chu3 hangzhou
Chu4 hangzhou
Chu5 chifan train

1200 *12 * 0.15 = 2160 fapiao medical fee. need pay

doing QLiving work
1. file form and email
2. HR hold meeting
3 Create

This websit has guide on wpa and hostapd. Thansk Atheors

https://wiki.gentoo.org/wiki/Wpa_supplicant  passpoint

wpa_supplicant\src\ap\hs20.c   generate eid and send wnm notification action frame


hs20_supplicant.h .c in wpa root , looks hs2.0 entry

compile marco CONFIG_HS20

wpa_supplicant_cleanup  --> to clean up hs2.0
wpa_supplicant_set_suites -> set security type
wpas_ext_capab_byte ->exten cap bit,  bit 46, WNM-Notification
wpas_start_assoc_cb -> add hs2.0 in IE buffer

Wpa_ie.c
wpa_gen_wpa_ie  -- > generate hs2.0 security IE

Wpa_common.c
wpa_eapol_key_mic -> key mehtod, caculation real value

wpa_cli.c

wpa_cli_complete_set 

CONFIG_MESH  发现mesh

2/29 

found R001 can't read

find tushare tushare\tushare\stock\Trading.py

 return 'sh%s'%code if code[:1] in ['5', '6', '9'] else 'sz%s'%code bug, shuold and '2' 
  

3/4 

Pandas handbook

http://pda.readthedocs.org/en/latest/chp5.html#series

http://pandas.pydata.org/pandas-docs/stable/dsintro.html

global val in pathon, can declare in function

have successfully make one timer to auto execute

make email notify and window message box pop up working

1. Mointer, send ems, weixin, email
2. stragy 


3/7 
mkisofs command to make iso file?

3/9
aritical about LPM

http://www.xuebuyuan.com/1671935.html
http://blogs.msdn.com/b/usbcoreblog/archive/2013/11/15/usb-2-0-lpm.aspx

type is the way to print data type

obj2 = Series([4, 7, -5, 3], index=['d', 'b', 'a', 'c'])
sdata = {'Ohio': 35000, 'Texas': 71000, 'Oregon': 16000, 'Utah': 5000}
obj3 = Series(sdata)

bj4.name = 'population'
obj.index = ['Bob', 'Steve', 'Jeff', 'Ryan']


   
3/10 

Series = value and index, value and index are all arrray
Series([value], index=[])
can get item by index
Series can do array math operation on each values

Series can also pick up from dict, and more, can pick up values from indexs.

In [20]: sdata = {'Ohio': 35000, 'Texas': 71000, 'Oregon': 16000, 'Utah': 5000}
In [21]: obj3 = Series(sdata)
In [22]: obj3
Out[22]:
Ohio 35000
Oregon 16000
Texas 71000
Utah 5000113


In [23]: states = [‘California’, ‘Ohio’, ‘Oregon’, ‘Texas’] 
In [24]: obj4 = Series(sdata, index=states) 
In [25]: obj4 
Out[25]: 
California NaN --> not a number
Ohio 35000
Oregon 
16000
Texas 71000

pd function isnull() or notnull()

Series has name and it's index also has name
In [32]: obj4.name = 'population'
In [33]: obj4.index.name = 'state'

frame['index']
frame.ix[] --for row
frame.loc[] -- also for row

data = {'state': ['Ohio', 'Ohio', 'Ohio', 'Nevada', 'Nevada'],
        'year': [2000, 2001, 2002, 2001, 2002],
        'pop': [1.5, 1.7, 3.6, 2.4, 2.9]}
frame = DataFrame(data)
frame2 = DataFrame(data, columns=['year', 'state', 'pop', 'debt'], index=['one', 'two', 'three', 'four', 'five'])


In [57]: pop = {'Nevada': {2001: 2.4, 2002: 2.9},
   ....: 'Ohio': {2000: 1.5, 2001: 1.7, 2002: 3.6}}
In [58]: frame3 = DataFrame(pop)
In [59]: frame3
Out[59]:
     Nevada Ohio
2000    NaN  1.5
2001    2.4  1.7
2002    2.9  3.6

ffill and bfill

In [84]: obj3 = Series(['blue', 'purple', 'yellow'], index=[0, 2, 4])
In [85]: obj3.reindex(range(6), method='ffill')

#reindex is for change index order

#remove try to one row

drop row
In [94]: obj = Series(np.arange(5.), index=['a', 'b', 'c', 'd', 'e'])
In [95]: new_obj = obj.drop('c')
In [96]: new_obj
Out[96]:
a   0
b   1
d   3
e   4
In [97]: obj.drop(['d', 'c'])
Out[97]:
a   0
b   1
e   4
sdrop coloum
data.drop('two', axis=1) 

frame.get_value(row,coloum)
frame.set_value(row, coloum, set_value)

http://www.cnphp6.com/archives/65844 python apply for graphic


http://unix.stackexchange.com/questions/107939/how-to-restart-the-python-script-automatically-if-it-is-killed-or-dies  // crash handling
*/5 * * * * pgrep -f testing.py || nohup python /home/you/scripts/testing.py > test.out

3/11

519880 3/11 buy 40 sell 85 single account 300w
http://www.99fund.com/main/index.shtml

What's CDO?

(CDO )Collateralized Debt Obligation 

CLO(Collateralised Loan Obligation)和CBO(Collateralised Bond Obligation)。All called CDO。

ABS（Asset-backed Securities）

119249 jindongyou01  400w start point
119250 jingdongyou02

huatai trade

http://htamc.htsc.com.cn/jhlc/product_2.jsp?productCode=948008

shenjiaosuo, zonghejiaoyi pingtai
http://www.szse.cn/main/ints/dzjy/

http://xueqiu.com/3559889031/23937592

what the account can do...

How to auto search web and save into one whole doc...?

http://www.ichangtou.com/ can have a look.

http://penfei84.blog.163.com/blog/static/11859714201087103811764/
way to setup xvncserver to gnome desktop
#!/bin/sh 
# Uncomment the following two lines for normal desktop: 
# unset SESSION_MANAGER 
# exec /etc/X11/xinit/xinitrc 
[ -x /etc/vnc/xstartup ] && exec /etc/vnc/xstartup 
[ -r $HOME/.Xresources ] && xrdb $HOME/.Xresources 
xsetroot -solid grey 
vncconfig -iconic & 
xterm -geometry 80x24+10+10 -ls -title "$VNCDESKTOP Desktop" & 
gnome-session & 
kde
#!/bin/s


http://blog.csdn.net/buyicn/article/details/44245489 //WPS button

How to build WPS

http://blog.csdn.net/highball/article/details/8312659 // build wps


Error:
genl.h
libnl-dev & libpopt-dev
after sudo, fixed.

new case -l ssl -l crypto
after comment ssl lib, solve -lssl

but fail -lcrypto
change wpa passre code can fix the build issue 

Then, buidl successful. happy :)

1) try to connect hydra use -Dwext succssl, -Dnlink not ok

2) PBC connection  use examples wpa-dbus-new-wps.py make wps success

https://technet.microsoft.com/en-us/library/cc771355(v=ws.10).aspx  windows error code

python dbus guide
https://dbus.freedesktop.org/doc/dbus-python/doc/tutorial.html

systemd guide
http://www.cnblogs.com/jasonliu/archive/2012/12/18/2822965.html

pbc, looks calling into wpas_start_pbc.. with different direction


Q=@
E=echo

Remove Q=@ can make make output more informations

MSFT Wireless API

https://msdn.microsoft.com/en-us/library/windows/desktop/aa371704(v=vs.85).aspx

// checkinf windows inf language
http://msdn.microsoft.com/en-us/library/ff543461(v=VS.85).aspx 

https://msdn.microsoft.com/en-us/library/windows/hardware/dn941087(v=vs.85).aspx 

The wpa_cli, 

default is useing unix socket to communicate with wpa_supplicate.
and, the key function is _wpa_ctrl_command. It will send command down, and print the result. 
this macro CTRL_IFACE_SOCKET is enabled. there also some unsolicited message back from wpa_supplicant

start_edit(); what's this function means for wpa_cli
use select() as delay method, and get current time and register time to fire timer.

This is linux OS API manule doc

linux.die.net/man/2/select 

3/22
Now understand how eloop running... it's basically on timer. fire one and when armed, re-set a new one.

wpa_printf, this is function to control print

Ctrl_iface.c wpa_supplicant_ctrl_iface_process

wpa_supplicant_run is the main run thread... reading now.  funny, it's also one eloop...hehe


two useful command in linux
ps -ef
pstree

start-stop-daemon in /etc/wpasupplicant/function.sh 

find place to show, why wpa supplicante service run auto
Should be enough to remove the file
/usr/share/dbus-1/system-services/fi.epitest.hostap.WPASupplicant.service
Move it somewhere so you can restore it, rather than immediately delete it. ;-)

main:
-> wpa_supplicant_init :  // after this fucntion call, eloop init, timer registered, global and priv create and hooked, driver interface also hooked.
  --> eap method hooked
  --> wpas_global_ctrl_iface_open_sock, this function hook up the message receive and message handler. Really key functions
  -->random_init(params->entropy_file); 
     --> eloop_register_read_sock(random_fd, random_read_fd, NULL, NULL); 
  --> wpas_notify_supplicant_initialized, init DBUS here  
  -->const struct wpa_driver_ops *const wpa_drivers[], driver's interface defination here
  --> WiFi CONFIG_WIFI_DISPLA also be here
  --> Register timer loop here,  eloop_register_timeout(WPA_SUPPLICANT_CLEANUP_INTERVAL, 0, wpas_periodic, global, NULL);
->fst_global_init  CONFIG_FST=y, Enable Fast Session Transfer (FST) 
->wpa_supplicant_add_iface //loop to add one wpa_supplicant_interface 
  --> wpa_supplicant_init_iface // add local interface
      --> wpa_config_read // read configuration file from disk
	  -->wpas_init_driver // select one driver ops function array, start to really hook with below driver
	  -->wpa_supplicant_init_wpa  // wpa in wpa_s interface, is state machine here...
	    ---> wpa_sm_init
	  -->wpa_drv_get_hw_feature_data // call driver api
	  -->wpa_drv_get_capa //call driver api 
	  -->wpa_supplicant_driver_init // update mac. 
	     ----> wpa_supplicant_update_mac_addr, // look here, l2_packet_int, hook wpa_supplicant_rx_eapol -->turn to  eloop_register_read_sock(l2->fd, l2_packet_receive, l2, NULL);
	  -->wpas_wps_init // wps moudle init
	     --> wpas_wps_set_uuid // init UUID based on mac
	  -->wpa_supplicant_init_eapol // init eapol state machie
	  -->wpa_sm_set_eapol // set value
	  -->wpa_supplicant_ctrl_iface_init  // wpas_ctrl_iface_open_sock  eloop_register_read_sock(priv->sock, wpa_supplicant_ctrl_iface_receive, wpa_s, priv);
	     -->wpas_global_ctrl_iface_open_sock
		    //wpa_msg_register_cb(wpa_supplicant_ctrl_iface_msg_cb);
	  -->gas_query_init
      -->wpas_p2p_init
	  -->wpa_bss_init
	  -->wpas_set_wowlan_triggers
	  -->pcsc_reader_init //SIM Card
	  -->wpas_init_ext_pw 
	  -->wpas_rrm_reset // RRM
      --> wpa_supplicant_set_state(wpa_s, WPA_DISCONNECTED); // implict to triger one scan.
      --> wpas_p2p_add_p2pdev_interface // add p2p 
  -->wpa_supplicant_set_state(WPA_DISCONNECTED)
  


  
wpa_supplicant_run //run... now.
wpa_supplicant_deinit // let's quite
...

authsrv_init(host apd) and eap_peer_sm_init may call it.

wpa_supplicant_init_eapol{ // memory is bring in,  free in deinit.
eapol_sm_init // Initialize EAPOL state machine
    ->eap_peer_sm_init
	  -> EAP_CLIENT_TIMEOUT_DEFAULT 60 ,  eap timeout value
      ->tls_init // called twices, for two SSL context, but, why? match to print "ENGINE: Loading dynamic engine"
	             // tls has many various.  look into tls_opensll.c as first entry.
	  
    ->sm->initialize = TRUE;
    ->eapol_sm_step(sm); // like a trigger to run state machine once to update data.
	  ->SM_STEP_RUN(SUPP_PAE); //sm_SUPP_PAE_Step  // function defined in eapol_supp\eapol_supp.sm.c
	     --> SM_STATE(SUPP_PAE, DISCONNECTED) // eapol_supp_sm.c
		    --> eapol_sm_set_port_unauthorized 
			   -->  call cb (wpa_supplicant_port_cb) 
			      -->wpa_drv_set_supp_port
	  ->SM_STEP_RUN(KEY_RX); //sm_KEY_RX_Step  
	    // just print, no other actions.
	  ->SM_STEP_RUN(SUPP_BE); //sm_SUPP_BE_Step
	    -.eapol_sm_abortSupp
	->sm->initialize = FALSE;
	->eapol_sm_step(sm);
	  --> eap_peer_sm_step "EAP entering state DISABLED" print comes from here   //eap.c
	->eloop_register_timeout(1, 0, eapol_port_timers_tick, NULL, sm);
}


static const struct eapol_callbacks eapol_cb =
{
	eapol_sm_get_config,
	eapol_sm_get_bool,
	eapol_sm_set_bool,
	eapol_sm_get_int,
	eapol_sm_set_int,
	{
	  eapol_enable_timer_tick
	}
	eapol_sm_get_eapReqData,
	eapol_sm_set_config_blob,
	eapol_sm_get_config_blob,
	eapol_sm_notify_pending,
	eapol_sm_eap_param_needed,
	eapol_sm_notify_cert,
	eapol_sm_notify_status,
#ifdef CONFIG_EAP_PROXY
	eapol_sm_eap_proxy_cb,
#endif /* CONFIG_EAP_PROXY */
	eapol_sm_set_anon_id
};


SM_ENTRY is to change state state status. only for debug proposal

pair, state define, enter call
SM_STATE is use to declare state function
SM_ENTER 

pair, state define, enter call
SM_STEP is to declarey state entry 
SM_STEP_RUN is call

 

/sbin/wpa_supplicant -B -P /run/sendsigs.omit.d/wpasupplicant.pid -u -s -O /var/run/wpa_supplicant


http://blog.csdn.net/wh_19910525/article/details/7392147  // WPA guide

how to make wpa_supplicant and wpa_cli run

1. stop network manager
service network-manager stop:


ps -ef | grep wpa to make sure no wpa runing, kill pid is ok

2. wpa_supplicant -B -Dwext -C/home/zliu/wpa_run -i wlan2
3. wpa_cli -p /home/zliu/wpa_run

Skills:  grep wpa_supplicant /var/log/syslog > outputfile
         tail -f /var/log/syslog
		 watch -d -n 1 cat /var/log/messages
		 
		 
/etc/wpasupplicant/function.sh  here some wpa supplicant script

3/24 successfully get wpasupplciant wps_pbc log.

PF_INET kernel control

PF_NETLINK  kernel event

PF_PACKET send 802.1x packet

wpa_driver_wext_event_wireless //handle kernel event
//Message can see in this handler
assoc/disassoc
KEY Error event
Customer Event
Scan complete
AssocReq_IE
AssocResp_IE
Pmkidcand//?? what's this for??


wpa_driver_wext_event_link // handle link event
only link add/remove message

hongkou gaozhong
http://www.hkedu.sh.cn/HKEdu.Web/Default/InfoDetail.aspx?SignIn=true&CategoryID=e4797d0d-3ecd-4d01-b515-225106b44346&InfoGuid=0c4dcff7-cc93-4a49-bb51-40a434c0fee1




3/31
Looked into wpas_wps_start_pbc, keep moving

wpas_m Control interface command 'WPS_PBC' -- this is log print

ctrl_iface_read_completed --
    -->wpa_supplicant_ctrl_iface_rx 
       -->wpa_supplicant_ctrl_iface_process 
	      --> wpa_supplicant_ctrl_iface_wps_pbc
	   {
wpas_wps_start_pbc
  - wpas_clear_wps //clear previous wps setting
     --eloop_cancel_timeout(wpas_wps_timeout, wpa_s, NULL);
	 --eloop_cancel_timeout(wpas_wps_clear_timeout, wpa_s, NULL);
	 --wpas_clear_wps
  -wpas_wps_add_network // return ssid, if null, then fail. ssid actually is config setting. ssid is settle here. below is OOB caculate for priority
    --wpa_config_add_network // allocate ssid. if not exist
	   --wpa_config_update_prio_list // 
	      -- wpa_config_add_prio_network // by 
	-wpas_notify_network_added // create somthing like interface in dbus. notify in dbus
	-wpa_config_set_network_defaults // default ssid fill up. 
	-ssid->temporary = 1;
	-wpa_config_set // set key_mgmt, eap, identity, registry  
	  -wpa_config_set(ssid, "key_mgmt", "WPS", 0) < 0 ||
	    wpa_config_set(ssid, "eap", "WSC", 0) < 0 ||
	    wpa_config_set(ssid, "identity", registrar ? "\"" WSC_ID_REGISTRAR "\"" : "\"" WSC_ID_ENROLLEE "\"", 0) < 0)
  -wpa_config_set(ssid, "phase1", "\"pbc=1\"", 0)
  - eloop_register_timeout(WPS_PBC_WALK_TIME (120 sec), 0, wpas_wps_timeout, wpa_s, NULL); // register pbc timeout period
  - wpas_wps_reassoc // start reassoc, prepare done, do work now.
     - wpas_wps_temp_disable // send disable notify
	 - wpa_supplicant_cancel_sched_scan // stop regular scan
	 - wpa_supplicant_req_scan // start wps scan...  jump to wpa_supplicant_scan
}

-- This is triggered by eloop
wpa_supplicant_scan
     - wpa_supplicant_enabled_networks
     - wpa_supplicant_trigger_scan // tigger scan 
	     - radio_add_work(wpa_s, 0, "scan", 0, wpas_trigger_scan_cb, ctx)
         - wpas_trigger_scan_cb //somehow here
            - wpa_supplicant_notify_scanning
			-wpa_drv_scan // call driver for scan
}

wpa_set_ssids_from_scan_req // this function consolidate multiple scan request in
wpa_supplicant_optimize_freqs // command to limit freq range
wpa_supplicant_extra_ies // build wps ie
  -- wpas_wps_in_use // return true(1) when ssid->key_mgmt & WPA_KEY_MGMT_WPS
  -- wps_build_probe_req_ie // build wps ie here  extra_ie is allocate in wpabuf_resize()
   wpas_wps_set_uuid //this is the default uuid comes from
   
  -- wpa_supplicant_mesh_add_scan_ie // mesh ie
wpa_setband_scan_freqs // set band
wpa_supplicant_build_filter_ssids // in the mean time, hold extra ie in params..  scan rand mac also here

wpa_scan_clone_params // as the end, clone the scan parameters.  actaully, this is the good place to dump scan parameters
radio_add_work // should schedule the work

wpas_trigger_scan_cb -- this is the call back to continue do scan command (up to down) work

   -wpas_update_random_addr_disassoc // assign random address 
   -wpa_supplicant_notify_scanning // notify scan for dbus
   -wpa_drv_scan // ask driver to scan
        after scan,  it will wait scan event from driver
	    SO BRIEFLY, to ask scan simply
   -wpa_scan_free_params
-- here, supplicant is done, the next trigger event is driver scan complete event   

wpa_driver_wext_event_wireless 
 - wpa_supplicant_event // functions in events.c
 -wpa_supplicant_event_scan_results // 
   -- wpa_drv_get_scan_results2 // calling driver to get results
      -- wpa_driver_wext_giwscan , drv call
	      -- filter_scan_res // filter at this stage...
	  -- dump_scan_res //dump scan result
	  --wpa_bss_update_scan_res // by bss result update
	  --wpa_bss_update_end // end scan update
	  -- wpas_select_network_from_last_scan // select one network and do scan
	     -- wpa_supplicant_pick_network  // do cherry pick
		    -- wpa_supplicant_select_bss
			   -- wpa_scan_res_match // here, 
	  -- wpa_supplicant_connect or wpa_supplicant_associate
	  
	  --radio_add_work(wpa_s, bss ? bss->freq : 0, "connect", 1,  wpas_start_assoc_cb, cwork) < 0) 
Trying to associate with 00:0c:43:44:0d:a8 (SSID='RalinkInitAP_440DA8' freq=2437 MHz) -- log print	  
	   --wpa_supplicant_cancel_scan
	   --wpa_sm_set_assoc_wpa_ie
	   --wps_build_assoc_req_ie
	   --wpa_clear_keys(wpa_s, bss ? bss->bssid : NULL);
	   --wpa_supplicant_set_state(wpa_s, WPA_ASSOCIATING);
	   -- wpa_drv_associate
	   --wpa_supplicant_req_auth_timeout // set timeout time for auth, 60s
	   --wpa_supplicant_rsn_supp_set_config // prepare eapol
	   --wpa_supplicant_initiate_eapol // init
	      - eapol_sm_notify_config
		  - ieee802_1x_alloc_kay_sm

// OK, here, only waiting for connect event from driver

		  
// below is the log to show associate success
Wireless event: cmd=0x8b15 len=20
wpa_driver_wext_event_wireless cmd=8b15
Wireless event: new AP: 00:0c:43:44:0d:a8
wpa_driver_wext_event_assoc_ies
wpas_m Event ASSOC (0) received

wpa_driver_wext_event_wireless
     -- wpa_driver_wext_event_assoc_ies
	      --wpa_supplicant_event(drv->ctx, EVENT_ASSOCINFO, &data);
	        --wpa_supplicant_event_associnfo // only handle assoc req and resp ie. looks ie updates.
			   -- wpa_sm_set_ft_params // set 11r ie
	 --wpa_supplicant_event(drv->ctx, EVENT_ASSOC,NULL);
	      -- wpa_supplicant_event_assoc(wpa_s, data);
		     -- eloop_cancel_timeout(wpas_network_reenabled, wpa_s, NULL);
			 -- wpa_supplicant_event_associnfo
			 -- wpa_drv_get_bssid
			 --wpa_supplicant_set_state(wpa_s, WPA_ASSOCIATED);
			 --wpa_sm_notify_assoc(wpa_s->wpa, bssid);
			 -- if (wpa_s->l2) l2_packet_notify_auth_start(wpa_s->l2);
			 -- eapol_sm_notify_portEnabled(wpa_s->eapol, FALSE);
		     -- eapol_sm_notify_portValid(wpa_s->eapol, FALSE);
			 --eapol_sm_notify_portEnabled(wpa_s->eapol, TRUE);
			   -- eapol_sm_step
			      -- SM_STATE(SUPP_PAE, CONNECTING)
				     -- eapol_enable_timer_tick
					 -- eapol_sm_txStart
					    -- sm->ctx->eapol_send(sm->ctx->eapol_send_ctx, IEEE802_1X_TYPE_EAPOL_START, (u8 *) "", 0);  // wpa_supplicant_eapol_send
						   -- wpa_alloc_eapol // create packet
						   --wpa_ether_send // send packet Send Ethernet frame
						      -- if (wpa_s->l2) l2_packet_send
							     -- sendto
			 --wpa_supplicant_req_auth_timeout(wpa_s, 10, 0); /* Timeout for receiving the first EAPOL packet */
		     -- wpa_supplicant_cancel_scan(wpa_s);
			 --wpas_wps_notify_assoc(wpa_s, bssid);
			 --wmm_ac_notify_assoc
		  --if (data->assoc_info.authorized) wpa_supplicant_event_assoc_auth(wpa_s, data);
		    -- wpa_sm_set_rx_replay_ctr
			-- wpa_sm_set_ptk_kck_kek
			
// From now on, two events can trigger,  timeout or receive packet
eapol_port_timers_tick -- this tick trigger two times, and the last one go into l2 packet receive

l2_packet_receive // l2_packet_linux.c
  -- l2->rx_callback(l2->rx_callback_ctx, ll.sll_addr, buf, res); // handle_read in driver_bsd.c
     -- drv_event_eapol_rx // in driver.h
	   -- wpa_supplicant_event(ctx, EVENT_EAPOL_RX, &event); // enter state machine
	     -- wpa_supplicant_rx_eapol // wpa_supplicant.c  
		       * This function is called for each received EAPOL frame. Most driver
               * interfaces rely on more generic OS mechanism for receiving frames through
               * l2_packet, but if such a mechanism is not available, the driver wrapper may
               * take care of received EAPOL frames and deliver them to the core supplicant
               * code by calling this function.
		-- eapol_sm_rx_eapol // Process received EAPOL frames
		   -- possible eapol_sm_step to move forward
		-- opt wpa_drv_poll(wpa_s);
		

	  

4/5
Found syslog begin to lost message. typical print is like below:	
 "imuxsock begins to drop messages from"
 
 # echo  "\$SystemLogRateLimitInterval 60" >> /etc/rsyslog.conf
# echo "\$SystemLogRateLimitBurst 3000" >> /etc/rsyslog.conf
# /etc/init.d/rsyslog restart
Shutting down system logger:                               [  OK  ]
Starting system logger:                                    [  OK  ]

_wpa_supplicant_event_scan_results :{
wpa_supplicant_get_scan_results -- handle scan result event from driver
  -- scan_snr & scan_est_throughput // caculate signal strength and t-put
  -- dump_scan_res // dump result
  -- wpa_bss_update_scan_res
  -- wpa_bss_update_end // update end
     -- wpa_bss_add // add new bss each
	 -- wpa_bss_update_end //scan done
  -- wpas_wps_update_ap_info // dump wps ap
  -- radio_work_done
  -- wpas_select_network_from_last_scan //
     -- wpa_supplicant_pick_network // pick up one network to connect
	    -- wpa_supplicant_ssid_bss_match // check PBC..
		--wpa_supplicant_connect // here we go connect
		-- wpa_supplicant_associate // ended here
		--radio_add_work(wpa_s, bss ? bss->freq : 0, "connect", 1,
			   wpas_start_assoc_cb, cwork) < 0) // add radio work connect as the last item. execute immediately
 }
 
 
 wpas_start_assoc_cb:{
 
 new workitem running..
 
    -- wpa_drv_associate // call driver assoc with param structure
	
 }
 
 // connect wireless event
 wpa_driver_wext_event_wireless :{
 
 -- next trigger item
   ctx->eapol_send = wpa_supplicant_eapol_send;
   --  wpa_supplicant_eapol_send is called to send eapol frame
 }
 
 SM_STATE(SUPP_PAE, CONNECTING) // this is the trigger point
 
 https://msdn.microsoft.com/en-us/library/windows/hardware/dn265671(v=vs.85).aspx //USB MSFT handler 
 
 
 4/7 How to make ID print
 
 W: 8.56 cm (3.37")  H 5.4 cm (2.125")
 
 
 Intel 8260 
 
 zhihual_qca@outlook   
 
 name/number
 
 SMPS
 
 2107620279
 
 fullname
 123
 
 
4/18 
http://www.dianping.com/shop/21213568


13761374613 
6688 

21280

4/21


netlink_init is called at wpa_driver_wext_init, to receive event from driver

netlink_receive is the root.   Netlink.c


wpas_periodic -- repeat appear.

WPA_SUPPLICANT_CLEANUP_INTERVAL // 10s periodic timer

wpa_driver_wext_get_scan_results this function call will turn out to
{
wext_get_scan_mode
wext_get_scan_qual
.... Repeat
}

from wpa_driver_wext_event_assoc_ies wireless event

l2_packet_receive is the entery point for mgmt frame

4/22

What's the relationship with EAP  SUPP_PAE  SUPP_BE state machine means.


eap.c  EAP state machie
eapol_supp_sm.c  SUPP_BE  SUPP_PAE  KEY_RX

in eapol_supp_sm.c
eapol_sm_init (SUPP_BE SUPP_PAE , KEY_RX) alloca EAP 

http://www.ietf.org/rfc/rfc4137.txt way to understand EAP state machine

wpa_supplicant_initiate_eapol // eapol running point
   -- eapol_sm_notify_eap_success   
   {
    sm->eapSuccess = success;
	sm->altAccept = success;
	if (success)
		eap_notify_success(sm->eap);
	eapol_sm_step(sm)
   
   }
   -- eapol_sm_notify_eap_fail
   {
    sm->eapFail = fail;
	sm->altReject = fail;
	eapol_sm_step(sm);
   }
   -- eapol_sm_notify_portControl(wpa_s->eapol, Auto);
   {
     sm->portControl = portControl;
	 eapol_sm_step(sm);
   }
   
// when receive assoc event
wpa_supplicant_event_assoc
{
  eapol_sm_notify_portEnabled(wpa_s->eapol, FALSE);
  {
    if (sm->portEnabled != enabled)
		sm->force_authorized_update = TRUE;
	    sm->portEnabled = enabled;
	    eapol_sm_step(sm);
    }
  eapol_sm_notify_portValid(wpa_s->eapol, FALSE); 
    {
	   sm->portValid = valid;
	   eapol_sm_step(sm);
	}
  eapol_sm_notify_portEnabled(wpa_s->eapol, TRUE);
    {
	   
	
	}

}

SM_STEP(SUPP_PAE)

SM_STATE_ENTRY will mark change = 1, so we run again and again


4/16

Look at lora intraduction. the company name is Semtech which has IC and gateway.
https://www.lora-alliance.org/

http://www.multitech.net/ here is another IOT company
http://www.kerlink.fr/en/ 3rd one.

fork lora code on github

https://iotblog.org/ one blog for lora


https://github.com/TheThingsNetwork/ code example

http://thethingsnetwork.org/

4/28

802.11k is radio measure meent, link and radio measure. also, neighbor reprot. three pair action frames.

802.11j is for 5G japan, eur, us channel useage. 

802.11v  WNM, wireless network managment


The WNM service includes the following:
— BSS Max idle period management
— BSS transition management
— Channel usage
— Collocated interference reporting
— Diagnostic reporting
— Directed multicast service (DMS)
— Event reporting
— Flexible multicast service (FMS)
— Location services
— Multicast diagnostic reporting
— Multiple BSSID capability
— Proxy ARP
— QoS traffic capability
— SSID list
— Triggered STA statistics
— TIM broadcast
— Timing measurement
— Traffic filtering service
— U-APSD Coexistence
— WNM-Notification
— WNM-Sleep mode

802.11r is fast roaming during APs

802.11u is netowrk discovery and selection by STA
ANQP
EAS
GAS
NAI

Interworking Information element,  access network options, B4 is present internet indicator

PMK Caching vs OKC

PMK Caching is defined in 802.11i . signle AP and one STA. 

OKC, similar, but not in 802.11i.  multiple AP with one STA

MSFT suport in xp since then. 

http://community.arubanetworks.com/aruba/attachments/aruba/115/1097/1/Aruba+OKC+Implementation.pdf  //doc for PMK and OKC


5/1

l2_packet_receive -- start from here to analysis eapol state machine
{
l2->rx_callback // call up directly, prevous register   wpa_s->l2 = l2_packet_init(wpa_s->ifname,  wpa_drv_get_mac_addr(wpa_s),  ETH_P_EAPOL,  wpa_supplicant_rx_eapol, wpa_s, 0);
equal call wpa_supplicant_rx_eapol 
   --if ap,  wpa_supplicant_ap_rx_eapol
   -- eapol_sm_rx_eapol // in eapol_supp_sm.c
      two code path:  IEEE802_1X_TYPE_EAP_PACKET and IEEE802_1X_TYPE_EAPOL_KEY
	  
	  in IEEE802_1X_TYPE_EAP_PACKET
	  {
	     --sm->eapReqData = wpabuf_alloc_copy(hdr + 1, plen); // copy req data
		 --eapol_sm_step to move forward  // should going into SM_ENTER(EAP, RECEIVED); sm->eapReq, this is set by sm->eapolEap = TRUE in SM_ENTER(SUPP_BE, REQUEST);
	  }
	  
	  in IEEE802_1X_TYPE_EAPOL_KEY
	  {
	    os_memcpy(sm->last_rx_key, buf, data_len);
		sm->rxKey = TRUE;
		eapol_sm_step(sm);
	  }
}

5/3 

We meet the problem that wpa log is limited in syslog. 
So, I'm trying to find way to solve it.

http://www.rsyslog.com/changing-the-settings/

Method:

1) vim /etc/rsyslog.conf 
$SystemLogRateLimitInterval 0
or 
$SystemLogRateLimitInterval 10
$SystemLogRateLimitBurst 500

2) /etc/init.d/rsyslog restart

Done

Heard another way for wpa debug
wpa_supplicant -Dnl80211 -i wlan0 -c /etc/wpa_supplicant.conf -dd 

Great day, 

Get the whole process of WPS connection.  The first 8 handshake goes into EAP state machie,  the later 4 handshake, goes to wpa statemachine.   wpa_sm_rx_eapol

5/4


5/2

in function wpa_supplicant_rx_eapol, finally eapol reach to here. 
what's the logic?

if (!wpa_key_mgmt_wpa_psk(wpa_s->key_mgmt) &&
	    eapol_sm_rx_eapol(wpa_s->eapol, src_addr, buf, len) > 0)  -- let's dig this firstly
		return;
	wpa_drv_poll(wpa_s);
	if (!(wpa_s->drv_flags & WPA_DRIVER_FLAGS_4WAY_HANDSHAKE)) // this flag indicate drv do 4 way handshake
		wpa_sm_rx_eapol(wpa_s->wpa, src_addr, buf, len);
	else if (wpa_key_mgmt_wpa_ieee8021x(wpa_s->key_mgmt)) {
		/*
		 * Set portValid = TRUE here since we are going to skip 4-way
		 * handshake processing which would normally set portValid. We
		 * need this to allow the EAPOL state machines to be completed
		 * without going through EAPOL-Key handshake.
		 */
		eapol_sm_notify_portValid(wpa_s->eapol, TRUE);
	}

Below is eap having callbacks for eapol state machine

static const struct eapol_callbacks eapol_cb =
{
	eapol_sm_get_config,
	eapol_sm_get_bool,
	eapol_sm_set_bool,
	eapol_sm_get_int,
	eapol_sm_set_int,
	eapol_sm_get_eapReqData,
	eapol_sm_set_config_blob,
	eapol_sm_get_config_blob,
	eapol_sm_notify_pending,
	eapol_sm_eap_param_needed,
	eapol_sm_notify_cert,
	eapol_sm_notify_status,
#ifdef CONFIG_EAP_PROXY
	eapol_sm_eap_proxy_cb,
#endif /* CONFIG_EAP_PROXY */
	eapol_sm_set_anon_id
};

SM_STATE(EAP, RECEIVED)
{
 *This state is entered when an EAP packet is received (eapReq == TRUE) to
 * parse the packet header.
	eapReqData = eapol_get_eapReqData(sm);
	/* parse rxReq, rxSuccess, rxFailure, reqId, reqMethod */
	eap_sm_parseEapReq(sm, eapReqData);
	 -- switch(hdr->code) includig enum { EAP_CODE_REQUEST = 1, EAP_CODE_RESPONSE = 2, EAP_CODE_SUCCESS = 3,
       EAP_CODE_FAILURE = 4, EAP_CODE_INITIATE = 5, EAP_CODE_FINISH = 6 };
	 -- settle down sm->reqMethod = *pos++;
	 -- set sm->rxReq = TRUE; // should be clues to trigger another loop
}


5/4
http://club.autohome.com.cn/bbs/thread-c-874-34965773-1.html#3  car develop

study some car related mateir
5/5 
Finished WPS_PBC analysis log. 

Next, try WPA... and capture log.-- done, 

wps_pin any 6666 --done

5/6

starting on host hostapd

Build
1. extra source code
2. make defconfig copy and rename to .config
3. make. 
4. stop as error "cannot find -lssl" "cannot find -lcrypto"
5. after change makefile Q=@ to Q=; then, make makefile will give more inform. it points to /user/local/lib to search libary.
   so, add it mauanlly. 
6. Build success

Setup one simple AP. --failed. 

Looks we need make nl80211 driver works firstly.

5/7
iw is the power command in linux on wireless side.

nmcli nm wifi off // networkmanager command line 
rfkill unblock wlan 

upper two can make softap up and run

hostapd -dd hostapd.conf
###############################
Basic settings

interface=wlan0
driver=nl80211
ssid=My_wifi
channel=6
hw_mode=g
ignore_broadcast_ssid=0
auth_algs=1
wpa=3
wpa_passphrase=11111111
wpa_key_mgmt=WPA-PSK
wpa_pairwise=TKIP
rsn_pairwise=CCMP
#################################
